# =================================================================
# AIVENTURE GATEWAY - CONFIGURATION PRINCIPALE
# =================================================================
# Les valeurs sensibles sont chargées depuis le fichier .env

spring.application.name=aiventure-gateway
server.port=${SERVER_PORT:8080}

# =================================================================
# CONFIGURATION POSTGRESQL
# =================================================================
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/aiventure_gateway}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Pool de connexions HikariCP
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:5}
spring.datasource.hikari.idle-timeout=${DB_POOL_IDLE_TIMEOUT:300000}
spring.datasource.hikari.connection-timeout=${DB_POOL_CONNECTION_TIMEOUT:20000}
spring.datasource.hikari.max-lifetime=${DB_POOL_MAX_LIFETIME:1200000}

# Configuration JPA/Hibernate
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${DEBUG_ENABLED:false}
spring.jpa.properties.hibernate.format_sql=${DEBUG_ENABLED:false}
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# =================================================================
# CONFIGURATION JWT
# =================================================================
app.jwt.secret=${JWT_SECRET}
app.jwt.expiration=${JWT_EXPIRATION:3600000}
app.jwt.refresh.expiration=${JWT_REFRESH_EXPIRATION:86400000}

# =================================================================
# CONFIGURATION MICROSERVICES
# =================================================================
microservices.auth.url=${MICROSERVICE_AUTH_URL:http://localhost:8081}
microservices.auth.api-key=${MICROSERVICE_AUTH_API_KEY}
microservices.ia.url=${MICROSERVICE_IA_URL:http://localhost:8082}
microservices.ia.api-key=${MICROSERVICE_IA_API_KEY}
microservices.social.url=${MICROSERVICE_SOCIAL_URL:http://localhost:8083}
microservices.social.api-key=${MICROSERVICE_SOCIAL_API_KEY}

# =================================================================
# CONFIGURATION SÉCURITÉ AVANCÉE
# =================================================================
app.security.max-failed-attempts=${SECURITY_MAX_FAILED_ATTEMPTS:5}
app.security.lockout-duration=${SECURITY_LOCKOUT_DURATION:15}
app.security.max-sessions-per-user=${SECURITY_MAX_SESSIONS_PER_USER:3}
app.security.session-timeout=${SECURITY_SESSION_TIMEOUT:24}
app.security.bcrypt-rounds=${SECURITY_BCRYPT_ROUNDS:12}
app.security.encryption-key=${ENCRYPTION_SECRET_KEY}

# =================================================================
# CONFIGURATION CORS
# =================================================================
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080}
app.cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
app.cors.allowed-headers=${CORS_ALLOWED_HEADERS:Authorization,Content-Type,X-Requested-With,Accept,Origin}
app.cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
app.cors.max-age=${CORS_MAX_AGE:3600}

# =================================================================
# CONFIGURATION SSL/TLS
# =================================================================
server.ssl.enabled=${SERVER_SSL_ENABLED:false}
server.ssl.key-store=${SERVER_SSL_KEYSTORE:classpath:keystore.p12}
server.ssl.key-store-password=${SERVER_SSL_KEYSTORE_PASSWORD}
server.ssl.key-store-type=${SERVER_SSL_KEYSTORE_TYPE:PKCS12}

# =================================================================
# CONFIGURATION LOGGING
# =================================================================
logging.level.root=${LOG_LEVEL_ROOT:INFO}
logging.level.com.example.aiventuregateway=${LOG_LEVEL_AIVENTURE:INFO}
logging.level.org.springframework.security=${LOG_LEVEL_SECURITY:WARN}
logging.level.org.hibernate.SQL=${LOG_LEVEL_HIBERNATE:WARN}
logging.file.name=${LOG_FILE_PATH:logs/aiventure-gateway.log}
logging.file.max-size=${LOG_MAX_FILE_SIZE:10MB}
logging.file.max-history=${LOG_MAX_HISTORY:30}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# =================================================================
# CONFIGURATION ACTUATOR
# =================================================================
management.endpoints.web.exposure.include=${MANAGEMENT_ENDPOINTS_EXPOSURE:health,info,metrics}
management.endpoint.health.show-details=when-authorized
management.endpoints.web.base-path=/actuator
management.security.enabled=${MANAGEMENT_SECURITY_ENABLED:true}

# =================================================================
# UTILISATEURS PAR DÉFAUT (CHARGÉS AU DÉMARRAGE)
# =================================================================
app.default.admin.username=${DEFAULT_ADMIN_USERNAME:admin}
app.default.admin.password=${DEFAULT_ADMIN_PASSWORD}
app.default.admin.email=${DEFAULT_ADMIN_EMAIL:admin@aiventure.com}

# =================================================================
# CONFIGURATION SWAGGER/OPENAPI
# =================================================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.api-docs.enabled=true
